<main>
  <div class="container">
    <div class="row mt-5">
      <div class="col-2"></div>
      <div class="col-5">
        <h2><%= @post.title %> </h2>
      </div>
      <div class="col-1">
        <button type="button" class="btn btn-outline-danger">
          <%= link_to 'ÂâäÈô§', post_path(@post.id), class: "text-dark", method: :delete, "data-confirm" => "Êú¨ÂΩì„Å´Ê∂à„Åó„Åæ„Åô„ÅãÔºü" %>
        </button>
      </div>
      <div class="col-1">
        <button type="button" class="btn btn-outline-info">
          <%= link_to 'Á∑®ÈõÜ', edit_post_path(@post.id), class: "text-dark" %>
        </button>
      </div>
    </div>
    <div class="row mt-2">
      <div class="col-2"></div>
      <div class="pl-5 col-6">
        <%= link_to user_path(@user.id) do %>
        <h4><%= image_tag @user.get_profile_image(100,100) %><%= @post.user.name %></h4>
        <% end %>
        <%= @post.created_at.strftime('%Y/%m/%d') %>
        <div class="mt-3">
          <h5><%= @post.caption %></h5>
        </div>
        <div class="mt-3">
          <% if @post.image.attached? %>
          <%= image_tag @post.image, size: "300x250" %>
          <% end %>
        </div>
        <div class="mt-3">
          <h5>‰ΩèÊâÄ</h5>
          <p><%= @post.address %></p>

          <!-- Google„Éû„ÉÉ„ÉóË°®Á§∫„Ç®„É™„Ç¢(Âú∞Âõ≥„ÇíË°®Á§∫) -->
          <div id="map"></div>

          <!-- Google„Éû„ÉÉ„ÉóË°®Á§∫Áî®„ÅÆ Javascript -->
          <script>
            function initMap(){
              // Âú∞Âõ≥„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±(Á∑ØÂ∫¶„ÉªÁµåÂ∫¶)„ÇíÂèñÂæó
              let mapPosition = {lat: <%= @post.latitude || 0 %> , lng: <%= @post.longitude || 0 %> };
              let map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: mapPosition
              });
              let transitLayer = new google.maps.TransitLayer();
              transitLayer.setMap(map);

              let contentString = '„Äê‰ΩèÊâÄ„Äë<%= @post.address %>';
              let infowindow = new google.maps.InfoWindow({
                content: contentString
              });

              let marker = new google.maps.Marker({
                position: mapPosition,
                map: map,
                title: contentString
              });

              marker.addListener('click', function(){
                infowindow.open(map, marker);
              });
            }
          </script>

          <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
        </div>
      </div>
    </div>
    <div class="row mt-1">
      <div class="col-2"></div>
      <div class="col-1 text-right">
        <% if @post.favorited?(current_user) %>
        <%= link_to post_favorites_path(@post.id), method: :delete do %>
        <h5 style="color:red;">‚ù§<%= @post.favorites.count %></h5>
        <% end %>
        <% else %>
        <%= link_to post_favorites_path(@post.id), method: :post do %>
        <span>üíô<%= @post.favorites.count %></span>
        <% end %>
        <% end %>
      </div>
      <div class="col-1 text-center">
        <h5 class="font-weight-normal">üí¨<%= @post.comments.count %></h5>
      </div>
    </div>
    <div class="row">
      <div class="col-2"></div>
      <div class="pl-5 col-9">
        <% @comments.each do |comment| %>
        <%= image_tag comment.user.get_profile_image(45,45) %>
        <label class="font-weight-bold"><%= comment.user.name %></label></br>
        <div class="pl-5">
          <%= comment.comment %>
        </div>
        <% end %>
      </div>
    </div>
    <div class="row mt-4">
      <div class="col-2"></div>
      <div class="col-5">
        <h4>„Ç≥„É°„É≥„Éà„Çí„Åô„Çã</h4>
      </div>
    </div>
    <%= form_with(model:[@post, @comment], method: :post) do |f| %>
    <div class="row">
      <div class="col-2"></div>
      <div class="col-9 pl-5">
        <%= f.text_area :comment, style: "width:50%; height:100px;" %>
        <%= f.hidden_field :post_id, value: @post.id %>
      </div>
    </div>
    <div class="row mt-2 mb-3" style="height:200px;">
      <div class="col-4"></div>
      <div class="col-4">
        <%= f.submit 'ÈÄÅ‰ø°', class: "btn btn-sm btn-primary", style: "width:30%; height:40px;" %>
      </div>
    </div>
    <% end %>
  </div>
</main>